<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</title>
<style>
body{font-family:sans-serif;background:#111;color:#eee;margin:0;padding:10px}
h1{text-align:center;color:#6cf}
.tabs{display:flex;margin-bottom:10px}
.tab{flex:1;padding:10px;background:#222;text-align:center;cursor:pointer}
.tab.active{background:#6cf;color:#000;font-weight:bold}
.section{display:none}
.section.active{display:block}
input,select,button{margin:5px 0;padding:8px;width:100%;box-sizing:border-box}
.person{display:flex;gap:5px}
.person input{flex:1}
.result{margin-top:10px;padding:10px;background:#222;border-radius:6px;white-space:pre-line}
.timer{font-size:1.8em;text-align:center;margin-top:10px}
.copyBtn{background:#28a;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
.stopBtn{background:#a22;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
.calcBtn{background:#444;color:#fff;border:none}
.startBtn{background:#6cf;color:#000;border:none;font-weight:bold}
</style>
</head>
<body>

<h1>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab(0)">ğŸŒ UTCå‡ºç™ºè¨ˆç®—</div>
  <div class="tab" onclick="showTab(1)">ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰</div>
  <div class="tab" onclick="showTab(2)">ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰</div>
</div>

<h2>å‚åŠ è€…</h2>
<div id="people"></div>
<button onclick="addPerson()">å‚åŠ è€…è¿½åŠ </button>

<!-- ğŸŒ UTC -->
<div class="section active">
  <h3>åˆ°ç€UTCæ™‚åˆ»ï¼ˆæ™‚:åˆ†ï¼‰</h3>
  <input type="time" id="goalHM">
  <label>é›†çµå¾…æ©Ÿæ™‚é–“</label>
  <select id="waitTime"></select>
  <label>å¾®èª¿æ•´</label>
  <select id="adjustSec">
    <option value="-5">-5ç§’</option>
    <option value="0" selected>Â±0ç§’</option>
    <option value="5">+5ç§’</option>
  </select>
  <button onclick="calcUTC()" class="calcBtn">è¨ˆç®—</button>
  <div id="utcResult" class="result"></div>
</div>

<!-- ğŸŸ¦ CD -->
<div class="section">
  <button onclick="calcCD()" class="calcBtn">ã‚«ã‚¦ãƒ³ãƒˆè¨ˆç®—</button>
  <button onclick="startCD()" class="startBtn">ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹</button>
  <button onclick="stopTimer()" class="stopBtn">åœæ­¢</button>
  <div id="cdTimer" class="timer"></div>
  <div id="cdResult" class="result"></div>
</div>

<!-- ğŸŸ¥ CU -->
<div class="section">
  <button onclick="calcCU()" class="calcBtn">ã‚«ã‚¦ãƒ³ãƒˆè¨ˆç®—</button>
  <button onclick="startCU()" class="startBtn">é–‹å§‹</button>
  <button onclick="stopTimer()" class="stopBtn">åœæ­¢</button>
  <div id="cuTimer" class="timer"></div>
  <div id="cuResult" class="result"></div>
</div>

<script>
let cuData=[],cuMax=0,cuCount=0;

function showTab(n){
 document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("active",i===n));
 document.querySelectorAll(".section").forEach((s,i)=>s.classList.toggle("active",i===n));
}

function addPerson(){
 const d=document.createElement("div");
 d.className="person";
 d.innerHTML='<input placeholder="åå‰"><input type="number" placeholder="åˆ°é”ç§’">';
 people.appendChild(d);
}
addPerson();

function getData(){
 let arr=[];
 document.querySelectorAll(".person").forEach(p=>{
  const n=p.children[0].value||"åç„¡ã—";
  const s=parseFloat(p.children[1].value);
  if(!isNaN(s)) arr.push({name:n,time:s});
 });
 return arr;
}

function beep(){new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();}
function copyText(){navigator.clipboard.writeText(lastText);alert("ã‚³ãƒ”ãƒ¼å®Œäº†");}
function stopTimer(){
 clearInterval(timerInt);
 cdTimer.textContent="";
 cuTimer.textContent="";
 cuCount=0;
}

// ğŸŒ UTC
for(let i=0;i<=60;i++){let o=document.createElement("option");o.value=i*60;o.textContent=i+"åˆ†";waitTime.appendChild(o);}
function fmt(d){return d.toISOString().replace("T"," ").split(".")[0];}
function calcUTC(){
 const hm=goalHM.value;if(!hm)return alert("æ™‚åˆ»å…¥åŠ›");
 const now=new Date();const [h,m]=hm.split(":").map(Number);
 const g=new Date(Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),h,m,0));
 const wait=parseInt(waitTime.value);const adj=parseInt(adjustSec.value);

 let text=`ã€å‡ºç™ºUTCã€‘\nåˆ°ç€:${fmt(g)} UTC\né›†çµ:${waitTime.selectedOptions[0].text}\nå¾®èª¿æ•´:${adj}ç§’\n\n`;
 getData().forEach(d=>{
  const st=new Date(g.getTime()-(d.time+wait-adj)*1000);
  text+=`${d.name} â–¶ ${fmt(st)} UTC\n`;
 });
 lastText=text;
 utcResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';
}

// ğŸŸ¦ CD è¨ˆç®—
function calcCD(){
 const data=getData();if(data.length<2)return alert("2äººä»¥ä¸Š");
 const min=Math.min(...data.map(d=>d.time));
 const max=Math.max(...data.map(d=>d.time));
 cdCount=(max-min)+3;

 let text=`ã€CDè¨ˆç®—ã€‘å·®:${max-min}ç§’ â†’ ã‚«ã‚¦ãƒ³ãƒˆ:${cdCount}ç§’\n\n`;
 data.forEach(d=>text+=`${d.name}ï¼š${d.time-min}ç§’ã§å‡ºç™º\n`);
 lastText=text;
 cdResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';
}

// ğŸŸ¦ CD é–‹å§‹
function startCD(){
 if(cdCount<=0)return alert("å…ˆã«è¨ˆç®—");
 let c=cdCount;
 stopTimer();
 timerInt=setInterval(()=>{cdTimer.textContent=c;beep();c--;if(c<0)stopTimer();},1000);
}

// ğŸŸ¥ CU è¨ˆç®—
function calcCU(){
 cuData=getData();
 if(cuData.length<2) return alert("2äººä»¥ä¸Š");

 const max=Math.max(...cuData.map(d=>d.time));
 cuMax=max;

 let text=`ã€CUè¨ˆç®—ã€‘ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—${max}ç§’\n\n`;
 cuData.forEach(d=>{
   const start=max-d.time;
   text+=`${d.name}ï¼š${start}ç§’ã§å‡ºç™º\n`;
 });

 lastText=text;
 cuResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';
}

// ğŸŸ¥ CU é–‹å§‹
function startCU(){
 if(cuMax<=0) return alert("å…ˆã«è¨ˆç®—");

 stopTimer();
 cuCount=-3; // æº–å‚™3ç§’

 timerInt=setInterval(()=>{
  cuTimer.textContent=cuCount;
  beep();

  // å‡ºç™ºé€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°
  cuData.forEach(d=>{
    const start=cuMax-d.time;
    if(cuCount===start) console.log(d.name+" å‡ºç™º");
  });

  if(cuCount>=cuMax){ stopTimer(); return; }

  cuCount++;
 },1000);
}
</script>
</body>
</html>
