<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</title>
<style>
body{font-family:sans-serif;background:#111;color:#eee;margin:0;padding:10px}
h1{text-align:center;color:#6cf}
.tabs{display:flex;margin-bottom:10px}
.tab{flex:1;padding:10px;background:#222;text-align:center;cursor:pointer}
.tab.active{background:#6cf;color:#000;font-weight:bold}
.section{display:none}
.section.active{display:block}
input,select,button{margin:5px 0;padding:8px;width:100%;box-sizing:border-box}
.person{display:flex;gap:5px}
.person input{flex:1}
.result{margin-top:10px;padding:10px;background:#222;border-radius:6px;white-space:pre-line}
.copyBtn{background:#28a;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
.timer{font-size:1.8em;text-align:center;margin-top:10px}
</style>
</head>
<body>

<h1>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab(0)">ğŸŒ UTCå‡ºç™ºè¨ˆç®—</div>
  <div class="tab" onclick="showTab(1)">ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰</div>
  <div class="tab" onclick="showTab(2)">ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰</div>
</div>

<!-- å…±é€šå‚åŠ è€… -->
<h2>å‚åŠ è€…</h2>
<div id="people"></div>
<button onclick="addPerson()">å‚åŠ è€…è¿½åŠ </button>

<!-- ================= UTCè¨ˆç®— ================= -->
<div class="section active">
  <h3>åˆ°ç€UTCæ™‚åˆ»ï¼ˆæ™‚ã¨åˆ†ã ã‘ï¼‰</h3>
<input type="time" id="goalHM" step="60">

  <label>é›†çµå¾…æ©Ÿæ™‚é–“</label>
  <select id="waitTime"></select>

  <label>å¾®èª¿æ•´</label>
  <select id="adjustSec">
    <option value="-5">-5ç§’</option>
    <option value="0" selected>Â±0ç§’</option>
    <option value="5">+5ç§’</option>
  </select>

  <button onclick="calcUTC()">å‡ºç™ºæ™‚åˆ»ã‚’è¨ˆç®—</button>
  <div id="utcResult" class="result"></div>
</div>

<!-- ================= ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰ ================= -->
<div class="section">
  <button onclick="startCD()">ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹</button>
  <div id="cdTimer" class="timer"></div>
  <div id="cdResult" class="result"></div>
</div>

<!-- ================= ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰ ================= -->
<div class="section">
  <button onclick="startCU()">5ç§’æº–å‚™â†’é–‹å§‹</button>
  <button onclick="stopCU()">åœæ­¢</button>
  <div id="cuTimer" class="timer"></div>
</div>

<script>
let lastText="";
let cuInt=null,cuSec=0;
function beep(){new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();}

// ã‚¿ãƒ–
function showTab(n){
 document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("active",i===n));
 document.querySelectorAll(".section").forEach((s,i)=>s.classList.toggle("active",i===n));
}

// å‚åŠ è€…
function addPerson(){
 const d=document.createElement("div");
 d.className="person";
 d.innerHTML='<input placeholder="åå‰"><input type="number" placeholder="åˆ°é”ç§’">';
 people.appendChild(d);
}
addPerson();

// å¾…æ©Ÿæ™‚é–“ç”Ÿæˆ
for(let i=0;i<=60;i++){
 const o=document.createElement("option");
 o.value=i*60;o.textContent=i+"åˆ†";waitTime.appendChild(o);
}

// UTCè¨ˆç®—
function fmt(d){return d.toISOString().replace("T"," ").split(".")[0];}
function calcUTC(){
  const hm=document.getElementById("goalHM").value;
  if(!hm) return alert("æ™‚åˆ»å…¥åŠ›");

  const now=new Date();
  const [h,m]=hm.split(":").map(Number);

  // ä»Šæ—¥ã®UTCæ—¥ä»˜ã‚’å–å¾—
  const goalUTC=new Date(Date.UTC(
    now.getUTCFullYear(),
    now.getUTCMonth(),
    now.getUTCDate(),
    h,m,0
  ));

  const wait=parseInt(waitTime.value);
  const adj=parseInt(adjustSec.value);

  let text=`ã€å‡ºç™ºUTCæ™‚åˆ»ï¼ˆé›†çµæ™‚é–“å«ã‚€ï¼‰ã€‘\nåˆ°ç€äºˆå®š:${fmt(goalUTC)} UTC\né›†çµ:${waitTime.selectedOptions[0].text}\nå¾®èª¿æ•´:${adj}ç§’\n\n`;

  document.querySelectorAll(".person").forEach(p=>{
    const n=p.children[0].value||"åç„¡ã—";
    const s=parseFloat(p.children[1].value);
    if(isNaN(s)) return;

    const st=new Date(goalUTC.getTime()-(s+wait-adj)*1000);
    text+=`${n} â–¶ ${fmt(st)} UTC\n`;
  });

  lastText=text;
  utcResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';
}

function copyText(){navigator.clipboard.writeText(lastText);alert("ã‚³ãƒ”ãƒ¼å®Œäº†");}

// ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰
function startCD(){
 let times=[...document.querySelectorAll(".person input:nth-child(2)")].map(i=>parseFloat(i.value)).filter(x=>!isNaN(x));
 if(times.length<2)return alert("è¤‡æ•°äººå¿…è¦");
 const min=Math.min(...times),max=Math.max(...times);
 let cd=(max-min)+3;
 cdResult.textContent=`å·®:${max-min}ç§’ â†’ ã‚«ã‚¦ãƒ³ãƒˆ:${cd}ç§’`;
 const t=setInterval(()=>{cdTimer.textContent=cd;beep();cd--;if(cd<0)clearInterval(t);},1000);
}

// ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰
function startCU(){
 let prep=5;cuTimer.textContent="æº–å‚™ "+prep;
 const p=setInterval(()=>{prep--;cuTimer.textContent="æº–å‚™ "+prep;beep();
 if(prep<0){clearInterval(p);cuSec=0;
 cuInt=setInterval(()=>{cuTimer.textContent=cuSec;beep();cuSec++;},1000);}
 },1000);
}
function stopCU(){clearInterval(cuInt);}
</script>
</body>
</html>

