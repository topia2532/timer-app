<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é›†çµå¸ä»¤å¡”</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:sans-serif;
  background:#111;
  color:#fff;
  text-align:center;
}

/* ğŸ“± ã‚¹ãƒãƒ›å‘ã‘å·¨å¤§ãƒœã‚¿ãƒ³ */
button{
  padding:16px 22px;
  margin:6px;
  font-size:18px;
  border:none;
  border-radius:10px;
}

.tab button{
  font-size:16px;
}

.active{background:#0af;color:#fff;}
.section{display:none;margin-top:15px;}
.timer{font-size:64px;margin:15px;}
.result{white-space:pre-line;color:#7CFC00;margin-top:10px;}
input,select{
  padding:10px;
  margin:4px;
  font-size:18px;
  border-radius:6px;
}
</style>
</head>
<body>

<h1>ğŸ›° é›†çµå¸ä»¤å¡”</h1>

<h3>å‚åŠ è€…ã¨ç§»å‹•æ™‚é–“ï¼ˆç§’ï¼‰</h3>
<input id="name" placeholder="åå‰">
<input id="time" type="number" placeholder="ç§’">
<button onclick="add()">è¿½åŠ </button>
<p id="members"></p>

<div class="tab">
<button onclick="showTab('up')" class="active">ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
<button onclick="showTab('down')">ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</button>
<button onclick="showTab('utc')">ğŸŒ UTCå‡ºç™ºè¨ˆç®—</button>
</div>

<div id="up" class="section" style="display:block;">
<h2>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</h2>
<button onclick="calcUp()">è¨ˆç®—</button>
<div class="timer" id="upTimer">-</div>
<button onclick="startUp()">é–‹å§‹</button>
<button onclick="stopAll()">åœæ­¢</button>
<div class="result" id="upResult"></div>
<button onclick="copyResult('upResult')">çµæœã‚³ãƒ”ãƒ¼</button>
</div>

<div id="down" class="section">
<h2>ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</h2>
<button onclick="calcDown()">è¨ˆç®—</button>
<div class="timer" id="downTimer">-</div>
<button onclick="startDown()">é–‹å§‹</button>
<button onclick="stopAll()">åœæ­¢</button>
<div class="result" id="downResult"></div>
<button onclick="copyResult('downResult')">çµæœã‚³ãƒ”ãƒ¼</button>
</div>

<div id="utc" class="section">
<h2>UTCå‡ºç™ºè¨ˆç®—</h2>

åˆ°ç€UTC:
<input type="number" id="h" min="0" max="23" placeholder="æ™‚">
<input type="number" id="m" min="0" max="59" placeholder="åˆ†">
<input type="number" id="s" min="0" max="59" placeholder="ç§’">

<br><br>

å¾…æ©Ÿæ™‚é–“ï¼ˆåˆ†ï¼‰:
<input type="number" id="wait" min="0" max="60" value="0">

<br><br>

<button onclick="calcUTC()">è¨ˆç®—</button>
<div class="result" id="utcResult"></div>
<button onclick="copyResult('utcResult')">çµæœã‚³ãƒ”ãƒ¼</button>
</div>

<script>
let members=[];
let upTimes=[],downTimes=[];
let upInterval,downInterval;

/* ğŸ”Š éŸ³ */
function beep(freq=880,duration=120){
 const ctx=new (window.AudioContext||window.webkitAudioContext)();
 const osc=ctx.createOscillator();
 const gain=ctx.createGain();
 osc.connect(gain);
 gain.connect(ctx.destination);
 osc.frequency.value=freq;
 osc.start();
 gain.gain.setValueAtTime(0.2,ctx.currentTime);
 osc.stop(ctx.currentTime+duration/1000);
}

/* å‚åŠ è€…è¿½åŠ  */
function add(){
 const n=document.getElementById("name").value || ("å‚åŠ è€…"+(members.length+1));
 const t=parseInt(document.getElementById("time").value);
 if(!isNaN(t)){
   members.push({name:n,time:t});
   members.sort((a,b)=>a.time-b.time);
   document.getElementById("members").innerText =
     members.map(m=>m.name+"("+m.time+"s)").join(" / ");
 }
}

/* ã‚¿ãƒ–åˆ‡æ›¿ */
function showTab(id){
 document.querySelectorAll('.section').forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
 document.querySelectorAll('.tab button').forEach(b=>b.classList.remove('active'));
 event.target.classList.add('active');
}

/* ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ— */
function calcUp(){
 if(members.length===0)return;
 const max=Math.max(...members.map(m=>m.time));
 upTimes=members.map(m=>({name:m.name,start:max-m.time}));
 let text="æº–å‚™3ç§’ â†’ å‡ºç™º\n";
 upTimes.forEach(p=>text+=`${p.name}: ${p.start}ç§’\n`);
 document.getElementById("upResult").innerText=text;
}

function startUp(){
 let t=-3;
 const end=Math.max(...upTimes.map(p=>p.start));
 clearInterval(upInterval);
 upInterval=setInterval(()=>{
   upTimer.innerText=t;
   beep(600,80);
   if(t>=end){ beep(1200,300); clearInterval(upInterval); }
   t++;
 },1000);
}

/* ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ */
function calcDown(){
 if(members.length===0)return;
 const min=Math.min(...members.map(m=>m.time));
 downTimes=members.map(m=>({name:m.name,start:m.time-min}));
 const max=Math.max(...downTimes.map(p=>p.start));
 const total=max+3;
 downTimer.innerText=total;
 let text=`ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ ${total} ç§’\n`;
 downTimes.forEach(p=>text+=`${p.name}: ${p.start}ç§’\n`);
 document.getElementById("downResult").innerText=text;
}

function startDown(){
 let t=parseInt(downTimer.innerText);
 clearInterval(downInterval);
 downInterval=setInterval(()=>{
   downTimer.innerText=t;
   beep(600,80);
   if(t<=0){ beep(1200,300); clearInterval(downInterval); }
   t--;
 },1000);
}

/* ğŸŒ UTCè¨ˆç®—
   ç§»å‹•æ™‚é–“ï¼‹å¾…æ©Ÿæ™‚é–“ï¼åˆ°ç€æ™‚åˆ»
*/
function calcUTC(){
 if(members.length===0)return;

 const h=parseInt(document.getElementById("h").value)||0;
 const m=parseInt(document.getElementById("m").value)||0;
 const s=parseInt(document.getElementById("s").value)||0;
 const wait=parseInt(document.getElementById("wait").value)||0;

 let arrival=h*3600+m*60+s;

 let text="å‡ºç™ºUTC\n";

 members.forEach(mem=>{
   let depart=arrival-(mem.time+wait*60);
   depart=(depart+86400)%86400;

   const hh=String(Math.floor(depart/3600)).padStart(2,'0');
   const mm=String(Math.floor((depart%3600)/60)).padStart(2,'0');
   const ss=String(depart%60).padStart(2,'0');

   text+=`${mem.name}: ${hh}:${mm}:${ss}\n`;
 });

 document.getElementById("utcResult").innerText=text;
}

/* åœæ­¢ */
function stopAll(){
 clearInterval(upInterval);
 clearInterval(downInterval);
 upTimer.innerText="-";
 downTimer.innerText="-";
}

/* ã‚³ãƒ”ãƒ¼ */
function copyResult(id){
 navigator.clipboard.writeText(document.getElementById(id).innerText);
 alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
}
</script>
</body>
</html>
