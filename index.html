<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>同時ゴール司令塔</title>
<style>
body { font-family:sans-serif; background:#f5f7fa; padding:20px; text-align:center; }
.person { display:flex; gap:10px; margin-bottom:10px; }
input, select { padding:8px; font-size:16px; flex:1; }
button { padding:12px; font-size:18px; margin-top:10px; width:100%; }
.copyBtn { background:#4caf50; color:white; }
.section { margin-top:15px; }
.result { margin-top:15px; font-size:18px; text-align:left; background:white; padding:15px; border-radius:8px; }
label { display:block; margin-top:10px; }
</style>
</head>
<body>

<h1>同時ゴール司令塔</h1>

<div id="inputs"></div>
<button onclick="addPerson()">参加者を追加</button>

<div class="section">
  <label>到着予定UTC時刻：</label>
  <input type="datetime-local" id="goalTime">

  <label>集結待機時間：</label>
  <select id="waitTime">
    <option value="60">1分集結</option>
    <option value="300">5分集結</option>
    <option value="600">10分集結</option>
  </select>

  <label>
    <input type="checkbox" id="showJST"> JSTも併記する
  </label>

  <button onclick="calculateUTC()">出発時刻を計算</button>
</div>

<div id="results" class="result"></div>

<script>
let lastText="";

function addPerson(){
  const d=document.createElement("div");
  d.className="person";
  d.innerHTML=`<input placeholder="名前"><input type="number" placeholder="到達時間(秒)">`;
  document.getElementById("inputs").appendChild(d);
}

function formatTime(date, offset=0){
  const d=new Date(date.getTime()+offset*3600*1000);
  return `${String(d.getUTCHours()).padStart(2,'0')}:${String(d.getUTCMinutes()).padStart(2,'0')}:${String(d.getUTCSeconds()).padStart(2,'0')}`;
}

function calculateUTC(){
  const goal=document.getElementById("goalTime").value;
  const wait=parseInt(document.getElementById("waitTime").value);
  const showJST=document.getElementById("showJST").checked;

  if(!goal){alert("UTC時刻入れて");return;}

  const goalUTC=new Date(goal+"Z");
  const people=document.querySelectorAll(".person");

  let html="<h2>出発UTC時刻（集結時間含む）</h2>";
  let text="【出発UTC時刻（集結時間含む）】\n";

  people.forEach(p=>{
    const name=p.children[0].value||"名無し";
    const sec=parseFloat(p.children[1].value);
    if(isNaN(sec)) return;

    const st=new Date(goalUTC.getTime()-(sec+wait)*1000);
    const utc=formatTime(st,0);

    let line=`${name}  ▶  ${utc} UTC`;

    if(showJST){
      const jst=formatTime(st,9);
      line+=`  ／  ${jst} JST`;
    }

    html+=`<p>${line}</p>`;
    text+=line+"\n";
  });

  text+="\n--- 同時ゴール司令塔 ---";

  html+=`<button class="copyBtn" onclick="copyText()">結果をコピー</button>`;
  document.getElementById("results").innerHTML=html;
  lastText=text;
}

function copyText(){
  navigator.clipboard.writeText(lastText);
  alert("整形済み結果をコピーしました");
}

addPerson();
</script>
</body>
</html>
