<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>同時ゴール司令塔</title>
<style>
body { font-family:sans-serif; background:#f5f7fa; padding:20px; text-align:center; }
.person { display:flex; gap:10px; margin-bottom:10px; }
input { padding:8px; font-size:16px; flex:1; }
button { padding:12px; font-size:18px; margin-top:10px; width:100%; }
#mainTimer { font-size:64px; margin-top:20px; font-weight:bold; }
.stopBtn { background:#ff4d4d; color:white; }
.tabs button { width:48%; }
.active { background:#333; color:white; }
</style>
</head>
<body>

<h1>同時ゴール司令塔</h1>

<div class="tabs">
  <button id="upTab" class="active" onclick="switchMode('up')">カウントアップ（遠）</button>
  <button id="downTab" onclick="switchMode('down')">カウントダウン（近）</button>
</div>

<div id="inputs"></div>
<button onclick="addPerson()">参加者を追加</button>
<button onclick="calculate()">計算する</button>

<div id="startArea"></div>
<div id="mainTimer"></div>

<script>
let mode = "up";
let startTimes = [];
let downStartTimes = [];
let audioCtx;
let interval = null;
let prepInterval = null;
let t = 0;
let endTime = null;

function initAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function tone(freq, duration){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.value = freq;
  osc.start();
  gain.gain.setValueAtTime(1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration/1000);
  osc.stop(audioCtx.currentTime + duration/1000);
}

function switchMode(m){
