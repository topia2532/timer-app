<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</title>
<style>
body{font-family:sans-serif;background:#111;color:#eee;margin:0;padding:10px}
h1{text-align:center;color:#6cf}
.tabs{display:flex;margin-bottom:10px}
.tab{flex:1;padding:10px;background:#222;text-align:center;cursor:pointer}
.tab.active{background:#6cf;color:#000;font-weight:bold}
.section{display:none}
.section.active{display:block}
input,button{margin:5px 0;padding:8px;width:100%;box-sizing:border-box}
.person{display:flex;gap:5px}
.person input{flex:1}
.result{margin-top:10px;padding:10px;background:#222;border-radius:6px;white-space:pre-line}
.timer{font-size:1.8em;text-align:center;margin-top:10px}
.copyBtn{background:#28a;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
.stopBtn{background:#a22;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
</style>
</head>
<body>

<h1>åŒæ™‚ã‚´ãƒ¼ãƒ«å¸ä»¤å¡”</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab(0)">ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰</div>
  <div class="tab" onclick="showTab(1)">ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰</div>
</div>

<h2>å‚åŠ è€…</h2>
<div id="people"></div>
<button onclick="addPerson()">å‚åŠ è€…è¿½åŠ </button>

<!-- ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ -->
<div class="section active">
  <button onclick="startCD()">ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹</button>
  <button class="stopBtn" onclick="stopTimer()">åœæ­¢</button>
  <div id="cdTimer" class="timer"></div>
  <div id="cdResult" class="result"></div>
</div>

<!-- ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ— -->
<div class="section">
  <button onclick="startCU()">5ç§’æº–å‚™â†’é–‹å§‹</button>
  <button class="stopBtn" onclick="stopTimer()">åœæ­¢</button>
  <div id="cuTimer" class="timer"></div>
  <div id="cuResult" class="result"></div>
</div>

<script>
let timerInt=null,lastText="";

// ã‚¿ãƒ–
function showTab(n){
 document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("active",i===n));
 document.querySelectorAll(".section").forEach((s,i)=>s.classList.toggle("active",i===n));
}

// å‚åŠ è€…
function addPerson(){
 const d=document.createElement("div");
 d.className="person";
 d.innerHTML='<input placeholder="åå‰"><input type="number" placeholder="åˆ°é”ç§’">';
 people.appendChild(d);
}
addPerson();

function beep(){new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();}

function getData(){
 let arr=[];
 document.querySelectorAll(".person").forEach(p=>{
  const n=p.children[0].value||"åç„¡ã—";
  const s=parseFloat(p.children[1].value);
  if(!isNaN(s)) arr.push({name:n,time:s});
 });
 return arr;
}

// ğŸŸ¦ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆè¿‘ï¼‰
function startCD(){
 stopTimer();
 const data=getData(); if(data.length<2)return alert("2äººä»¥ä¸Š");
 const min=Math.min(...data.map(d=>d.time));
 const max=Math.max(...data.map(d=>d.time));
 let count=(max-min)+3;

 let text=`ã€ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä½œæˆ¦ã€‘\nå·®:${max-min}ç§’ â†’ ã‚«ã‚¦ãƒ³ãƒˆ:${count}ç§’\n\n`;
 data.forEach(d=>{
   const start=d.time-min;
   text+=`${d.name}ï¼š${start}ç§’ã§å‡ºç™º\n`;
 });

 lastText=text;
 cdResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';

 timerInt=setInterval(()=>{cdTimer.textContent=count;beep();count--;if(count<0)stopTimer();},1000);
}

// ğŸŸ¥ ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆé ï¼‰
function startCU(){
 stopTimer();
 const data=getData(); if(data.length<2)return alert("2äººä»¥ä¸Š");
 const min=Math.min(...data.map(d=>d.time));
 const max=Math.max(...data.map(d=>d.time));

 let text=`ã€ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ä½œæˆ¦ã€‘\n\n`;
 data.forEach(d=>{
   const start=max-d.time;
   text+=`${d.name}ï¼š${start}ç§’ã§å‡ºç™º\n`;
 });

 lastText=text;
 cuResult.innerHTML=text+'<button class="copyBtn" onclick="copyText()">çµæœã‚³ãƒ”ãƒ¼</button>';

 let prep=5;
 cuTimer.textContent="æº–å‚™ "+prep;
 timerInt=setInterval(()=>{
   beep();
   if(prep>0){prep--;cuTimer.textContent="æº–å‚™ "+prep;}
   else{cuTimer.textContent="+"+(5-prep-1)+"ç§’";}
 },1000);
}

function stopTimer(){clearInterval(timerInt);}

function copyText(){navigator.clipboard.writeText(lastText);alert("ã‚³ãƒ”ãƒ¼å®Œäº†");}
</script>
</body>
</html>
