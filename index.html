<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>同時ゴール司令塔</title>
<style>
body{font-family:sans-serif;background:#111;color:#eee;margin:0;padding:10px}
h1{color:#6cf;text-align:center}
.tabs{display:flex;margin-bottom:10px}
.tab{flex:1;padding:10px;background:#222;text-align:center;cursor:pointer}
.tab.active{background:#6cf;color:#000;font-weight:bold}
.section{display:none}
.section.active{display:block}
input,select,button{margin:5px 0;padding:8px;width:100%;box-sizing:border-box}
.person{display:flex;gap:5px}
.person input{flex:1}
.result{margin-top:10px;padding:10px;background:#222;border-radius:6px;white-space:pre-line}
.copyBtn{background:#28a;color:#fff;border:none;padding:10px;border-radius:4px;width:100%}
.timerDisplay{font-size:1.5em;text-align:center;margin-top:10px}
</style>
</head>
<body>

<h1>同時ゴール司令塔</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab(0)">UTC出発計算</div>
  <div class="tab" onclick="showTab(1)">カウントダウン</div>
  <div class="tab" onclick="showTab(2)">カウントアップ</div>
</div>

<!-- ================= UTC計算 ================= -->
<div class="section active" id="utcSection">
  <h2>参加者</h2>
  <div id="people"></div>
  <button onclick="addPerson()">参加者追加</button>

  <h2>到着UTC時刻</h2>
  <input type="datetime-local" id="goalTime">

  <label>集結待機時間</label>
  <select id="waitTime"></select>

  <label>微調整</label>
  <select id="adjustSec">
    <option value="-5">-5秒</option>
    <option value="0" selected>±0秒</option>
    <option value="5">+5秒</option>
  </select>

  <button onclick="calculateUTC()">出発時刻を計算</button>
  <div id="utcResult" class="result"></div>
</div>

<!-- ================= カウントダウン ================= -->
<div class="section" id="cdSection">
  <h2>カウントダウン</h2>
  <input type="number" id="cdSec" placeholder="秒数">
  <button onclick="startCountdown()">開始</button>
  <div id="cdDisplay" class="timerDisplay"></div>
</div>

<!-- ================= カウントアップ ================= -->
<div class="section" id="cuSection">
  <h2>カウントアップ</h2>
  <button onclick="startCountup()">開始</button>
  <button onclick="stopCountup()">停止</button>
  <div id="cuDisplay" class="timerDisplay">0秒</div>
</div>

<script>
let lastText="";
let cuInterval=null, cuSec=0;

// タブ切替
function showTab(n){
  document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("active",i===n));
  document.querySelectorAll(".section").forEach((s,i)=>s.classList.toggle("active",i===n));
}

// 参加者
function addPerson(){
  const div=document.createElement("div");
  div.className="person";
  div.innerHTML='<input placeholder="名前"><input type="number" placeholder="移動秒">';
  document.getElementById("people").appendChild(div);
}
addPerson();

// 待機時間0〜60分
const waitSel=document.getElementById("waitTime");
for(let i=0;i<=60;i++){
  const o=document.createElement("option");
  o.value=i*60;
  o.textContent=i+"分";
  waitSel.appendChild(o);
}

// 時刻整形
function fmt(d){return d.toISOString().replace("T"," ").split(".")[0];}

// UTC計算
function calculateUTC(){
  const goal=document.getElementById("goalTime").value;
  if(!goal){alert("時刻入力");return;}

  const goalUTC=new Date(goal+"Z");
  const wait=parseInt(waitSel.value);
  const adjust=parseInt(document.getElementById("adjustSec").value);

  let text=`【出発UTC時刻（集結時間含む）】\n到着予定: ${fmt(goalUTC)} UTC\n集結時間: ${waitSel.selectedOptions[0].text}\n微調整: ${adjust}秒\n\n`;
  document.querySelectorAll(".person").forEach(p=>{
    const name=p.children[0].value||"名無し";
    const sec=parseFloat(p.children[1].value);
    if(isNaN(sec)) return;
    const st=new Date(goalUTC.getTime()-(sec+wait-adjust)*1000);
    text+=`${name} ▶ ${fmt(st)} UTC\n`;
  });

  lastText=text;
  document.getElementById("utcResult").innerHTML=text+'<button class="copyBtn" onclick="copyText()">結果コピー</button>';
}

// コピー
function copyText(){navigator.clipboard.writeText(lastText);alert("コピー完了");}

// カウントダウン
function startCountdown(){
  let s=parseInt(cdSec.value);
  const disp=document.getElementById("cdDisplay");
  const i=setInterval(()=>{disp.textContent=s+"秒";s--;if(s<0)clearInterval(i);},1000);
}

// カウントアップ
function startCountup(){
  if(cuInterval) return;
  cuInterval=setInterval(()=>{cuSec++;cuDisplay.textContent=cuSec+"秒";},1000);
}
function stopCountup(){clearInterval(cuInterval);cuInterval=null;}
</script>

</body>
</html>
